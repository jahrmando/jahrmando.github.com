<!DOCTYPE html>
<html lang="es">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Configuración de Alfresco 4 en CentOS &middot; Tech Monkey
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/blackdoc.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=EB+Garamond">
  <link href="https://fonts.googleapis.com/css?family=Bree+Serif|Coustard" rel="stylesheet">
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Tech Monkey
        </a>
      </h1>
      <p class="lead">An Accidental Engineer • #Linux #DevOps #Programmer #Infosec</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">Acerca de</a>
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <hr>
      <a class="sidebar-nav-item" href="https://github.com/jahrmando/blackdoc">Repositorios</a>
    </nav>

    <p>&copy; 2017. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Configuración de Alfresco 4 en CentOS</h1>
  <span class="post-date">14 Mar 2013</span>
  <p>Instalaremos ALFRESCO Community desde el <code class="highlighter-rouge">.war</code> del webservice para hacerle deploy en un servicio Tomcat 6, usaremos una base de datos MySQL que este previamente configurado.</p>

<p>DESCARGA DE ARCHIVOS</p>

<p>Descargamos los paquetes que nos servirán en la instalación.</p>

<ul>
  <li><a href="http://wiki.alfresco.com/wiki/Community_file_list_4.2.c">alfresco-community-4.2.c.zip</a></li>
  <li><a href="http://www.oracle.com/technetwork/es/java/javase/downloads/index.html">jdk-7u17-linux-x64.rpm</a></li>
</ul>

<p>INSTALACION Y CONFIGURACION DE TOMCAT</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ yum install tomcat6
$ vim /etc/sysconfig/tomcat6
# Agregar al final del archivo
JAVA_OPTS="$JAVA_OPTS -Xms512m -Xmx512m -XX:MaxPermSize=256m"
</code></pre>
</div>

<p>INSTALACION Y CONFIGURACION DE JAVA</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ chmod u+x jdk-7u17-linux-x64.rpm
$ yum localinstall jdk-7u17-linux-x64.rpm
$ /usr/sbin/alternatives --install /usr/bin/java java /usr/java/jdk1.7.0_17/bin/java 17000 \
&gt; --slave /usr/lib/jvm/jre jre /usr/java/jdk1.7.0_17/jre \
&gt; --slave /usr/lib/jvm-exports/jre jre_exports /usr/java/jdk1.7.0_17/jre \
&gt; --slave /usr/bin/keytool keytool /usr/java/jdk1.7.0_17/bin/keytool \
&gt; --slave /usr/bin/rmiregistry rmiregistry /usr/java/jdk1.7.0_17/bin/rmiregistry \
&gt; --slave /usr/bin/javaws javaws /usr/java/jdk1.7.0_17/bin/javaws
$ /usr/sbin/alternatives --install /usr/bin/javac javac /usr/java/jdk1.7.0_17/bin/javac 1700 \
&gt; --slave /usr/lib/jvm/java java_sdk /usr/java/jdk1.7.0_17 \
&gt; --slave /usr/lib/jvm-exports/java java_sdk_exports /usr/java/jdk1.7.0_17/ \
&gt; --slave /usr/bin/javadoc javadoc /usr/java/jdk1.7.0_17/bin/javadoc \
&gt; --slave /usr/bin/javah javah /usr/java/jdk1.7.0_17/bin/javah \
&gt; --slave /usr/bin/jar jar /usr/java/jdk1.7.0_17/bin/jar \
&gt; --slave /usr/bin/jarsigner jarsigner /usr/java/jdk1.7.0_17/bin/jarsigner \
&gt; --slave /usr/bin/rmic rmic /usr/java/jdk1.7.0_17/bin/rmic
$ alternatives --config java
Hay 2 programas que proporcionan 'java'.
  Selección    Comando
  -----------------------------------------------
*+ 1           /usr/java/jdk1.6.0_43/bin/java
   2           /usr/java/jdk1.7.0_17/bin/java
   Presione Intro para mantener la selección actual[+], o escriba el número de la selección:  2
$ alternatives --config javac
Hay 2 programas que proporcionan 'javac'.
  Selección    Comando
  -----------------------------------------------
*+ 1           /usr/java/jdk1.6.0_43/bin/javac
   2           /usr/java/jdk1.7.0_17/bin/javac
   Presione Intro para mantener la selección actual[+], o escriba el número de la selección:  2

</code></pre>
</div>

<p>INSTALACION DE SERVICIOS DEPENDIENTES</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ yum install libreoffice-base libreoffice-calc libreoffice-core libreoffice-draw libreoffice-graphicfilter libreoffice-impress libreoffice-math libreoffice-writer libreoffice-xsltfilter libreoffice-headless xml-commons-apis mysql-connector-java ImageMagick t1lib
$ yum install swftools --enablerepo rpmforge
</code></pre>
</div>

<p>CONFIGURACION DE ALFRESCO</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mkdir alfresco
$ cd alfresco
$ mv alfresco-community-4.2.c.zip alfresco/
$ unzip alfresco-community-4.2.c.zip
$ cp web-server/webapps/* /var/lib/tomcat6/webapps/
$ cp -r web-server/shared /var/lib/tomcat6/
$ cp -r web-server/endorsed/ /var/lib/tomcat6/
$ chown :tomcat -R /var/lib/tomcat6/
$ chmod 775 -R /var/lib/tomcat6/
$ vim /etc/tomcat6/catalina.properties
# Agregar al final del archivo
shared.loader=/usr/share/java/mysql-connector-java.jar,${catalina.base}/shared/classes,${catalina.base}/shared/lib/*.jar
</code></pre>
</div>

<p>Iniciamos y detenemos el servicio para que generar los archivos de configuración del servicio</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ service tomcat6 start
Starting tomcat6:                               [  OK  ]
$ service tomcat6 status
tomcat6 (pid 2613) is running...                [  OK  ]
$ service tomcat6 stop
Stopping tomcat6:                               [  OK  ]
</code></pre>
</div>

<p>Creamos el archivo de configuración del webservice alfresco desde la plantilla</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cd /var/lib/tomcat6/shared/classes/
$ cp alfresco-global.properties.sample alfresco-global.properties
$ chmod 600 alfresco-global.properties
$ chown tomcat:tomcat alfresco-global.properties
</code></pre>
</div>

<p>Creamos el directorio de repositorio de alfresco</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mkdir /var/lib/alf_data
$ chown tomcat:tomcat /var/lib/alf_data
$ chmod 700 /var/lib/alf_data
</code></pre>
</div>

<p>Configuramos el servicio alfresco</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ vim alfresco-global.properties
#
# Sample custom content and index data location
#
dir.root=/var/lib/alf_data
dir.keystore=/var/lib/tomcat6/webapps/alfresco/WEB-INF/classes/alfresco/keystore
#
# Sample database connection properties
#
db.username=MiUsuario
db.password=MiPassword
#
# MySQL connection
# Tome en CUENTA la URL de conexion apunta a LOCALHOST, 
db.driver=com.mysql.jdbc.Driver
db.url=jdbc:mysql://localhost:3306/alfresco?useUnicode=yes&amp;amp;characterEncoding=UTF-8
# Libreoffice service
ooo.exe=/usr/bin/soffice
ooo.enabled=true
jodconverter.officeHome=/usr/bin/libreoffice
jodconverter.portNumbers=8101
jodconverter.enabled=true
# Utilidades del sistema 
img.dyn=/usr/lib64/ImageMagick-6.5.4
img.exe=/usr/bin/convert
swf.exe=/usr/bin/pdf2swf
# Outbound SMTP 
mail.host=mail.midominio.com.mx
mail.port=465
mail.username=mi_usuario
mail.password=MiPassword
mail.encoding=UTF-8

mail.from.default=noreply@midominio.com.mx
mail.from.enabled=true
mail.protocol=smtps
mail.smtp.auth=false
mail.smtp.debug=false
mail.smtp.timeout=5000
mail.smtp.starttls.enable=false

mail.smtps.auth=true
mail.smtps.starttls.enable=true
#
authentication.chain=alfrescoNtlm1:alfrescoNtlm
#
#
# URL Generation Parameters
#
alfresco.context=alfresco
alfresco.host=alfresco.midominio.com
alfresco.port=8080
alfresco.protocol=http
#
share.context=share
share.host=share.midominio.com
share.port=8080
share.protocol=http
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>$ vim /var/lib/tomcat6/webapps/alfresco/WEB-INF/classes/log4j.properties
log4j.appender.File.File=/var/log/tomcat6/alfresco.log

$ vim /var/lib/tomcat6/webapps/share/WEB-INF/classes/log4j.properties
log4j.appender.File.File=/var/log/tomcat6/share.log

$ vim /var/lib/tomcat6/webapps/alfresco/WEB-INF/classes/alfresco/subsystems/fileServers/default/file-servers.properties
# Por defecto estas variables estan en TRUE cabialas a FALSE si no usaras los 
# servicios que se listan
cifs.enabled=false
ftp.enabled=false
</code></pre>
</div>

<p>VALIDACION DEL CERTIFICADO DE MAIL - SSL CA java</p>

<p>Aplica este caso solo si tu servidor de correo usa un CA (certificado de autoridad) no valido y que tu conexión lo haras por SMTPS SSL. Cuando tu certificado de CA la has expedido de manera personal y no por una institución (VerySing ejemplo) es necesario agregar tu CA a los repositorios de tu maquina virtual de java, de lo contrario no podrás hacer una conexión SSL a tu servidor de correos.</p>

<p>Descargando SSLPoke que nos permitira hacer una prueba de conexion SSL con Java</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ wget -O SSLPoke.class http://confluence.atlassian.com/download/attachments/180292346/SSLPoke.class?version=1&amp;modificationDate=1236556489366
</code></pre>
</div>

<p>Ejecutando para probar la conexion SSL con java</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ java SSLPoke mail.midominio.com.mx 465
sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
    at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:385)
    at sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:292)
    at sun.security.validator.Validator.validate(Validator.java:260)
    at sun.security.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:326)
    at sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:231)
    at sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:126)
    at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1323)
    at sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:153)
    at sun.security.ssl.Handshaker.processLoop(Handshaker.java:868)
    at sun.security.ssl.Handshaker.process_record(Handshaker.java:804)
    at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:1016)
    at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1312)
    at sun.security.ssl.SSLSocketImpl.writeRecord(SSLSocketImpl.java:702)
    at sun.security.ssl.AppOutputStream.write(AppOutputStream.java:122)
    at sun.security.ssl.AppOutputStream.write(AppOutputStream.java:136)
    at SSLPoke.main(SSLPoke.java:31)
    Caused by: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
    at sun.security.provider.certpath.SunCertPathBuilder.engineBuild(SunCertPathBuilder.java:196)
    at java.security.cert.CertPathBuilder.build(CertPathBuilder.java:268)
    at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:380)
</code></pre>
</div>

<blockquote>
  <p>Este error sale porque no se pudo realizar la conexion debido a un CA Invalido o no encontrado en el repositorio</p>
</blockquote>

<p>Configurar InstallCert y para validar el CA del servidor</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ wget -O InstallCert.java http://confluence.atlassian.com/download/attachments/180292346/InstallCert.java?version=1&amp;modificationDate=1315453596921
$ chmod ug+x InstallCert.java
$ javac InstallCert.java
$ java InstallCert mail.midominio.com.mx:465
</code></pre>
</div>

<p>Copiando el certificado CA</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cp jssecacerts /usr/java/jdk1.7.0_17/jre/lib/security/
</code></pre>
</div>

<p>Volvemos a intentar conectarnos por SSL y probar el certificado</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ java SSLPoke mail.midominio.com.mx 465
Successfully connected
</code></pre>
</div>

<p>CONFIGURACION DE IPTABLES FIREWALL</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ vim /etc/sysconfig/iptables
-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 8080 -j ACCEPT
$ service iptables restart
</code></pre>
</div>

<p>CONFIGURACION DE HOST NAME</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 alfresco alfresco.midominio.com share.midominio.com
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6 alfresco alfresco.midominio.com share.midominio.com
10.0.0.XX   alfresco alfresco.midominio.com share.midominio.com
</code></pre>
</div>

<p>PROXY HTTP</p>

<p>Configuraremos un proxy para re-dirección con apache para no tener que acceder al servicio por el puerto 8080 y este sea mas ameno el link a los lusers.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ yum install httpd
$ chkconfig httpd on
$ vim /etc/httpd/conf/httpd.conf
#
ServerAdmin admin@midominio.com.mx
ServerName alfresco.midominio.com:80
#
NameVirtualHost *:80
#
&lt;VirtualHost *:80&gt;
	ServerName share.midominio.com
	ProxyRequests Off
	RewriteEngine On
	Redirect / http://share.midominio.com/share
	ProxyPass /share http://share.midominio.com:8080/share
	ProxyPassReverse /share http://share.midominio.com:8080/share
	ErrorLog /var/log/httpd/share.midominio.com.error.log
	CustomLog /var/log/httpd/share.midominio.com.access.log common
&lt;/VirtualHost&gt; 
#
&lt;VirtualHost *:80&gt;
	ServerName alfresco.red-alf.com
	ProxyRequests Off
	RewriteEngine On
	RewriteRule ^/alfresco/(.*) /$1 [PT]
	ProxyPass / http://127.0.0.1:8080/alfresco/
	ProxyPassReverse / http://127.0.0.1:8080/alfresco/
	ErrorLog /var/log/httpd/alfresco.midominio.com.error.log
	CustomLog /var/log/httpd/alfresco.midominio.com.access.log common
&lt;/VirtualHost&gt;
</code></pre>
</div>

<p>Reinciamos</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ service httpd start
</code></pre>
</div>

</div>

<div class="related">
  <h2>Quizas te interese</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2017/02/20/aplicaci%C3%B3n-de-parches-en-vmware-esxi-5x/">
            Aplicación de parches en VMware ESXi 5.x
            <small>20 Feb 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/12/09/clonaci%C3%B3n-y-migraci%C3%B3n-en-tiempo-real-live/">
            Clonación y migración en tiempo real de instancias virtuales Qemu/KVM
            <small>09 Dec 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/12/04/the-netflix-tech-blog-an%C3%A1lisis-del-rendimiento/">
            Análisis del rendimiento de Linux en 60 Segundos
            <small>04 Dec 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
